<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ€ç»´è¿›åŒ–è®­ç»ƒè¥ | Logic Master</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #050505;
            --card-bg: #121212;
            --text-main: #ffffff;
            --text-sub: #888888;
            --accent-blue: #3b82f6; 
            --accent-purple: #8b5cf6;
            --glow: rgba(59, 130, 246, 0.6);
            --gold: #f59e0b;
            --input-bg: #1a1a1a;
            --border: #2a2a2a;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Noto Sans SC', -apple-system, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* èƒŒæ™¯æ°›å›´å…‰ */
        body::before {
            content: ''; position: fixed; top: -20%; left: 50%; transform: translateX(-50%);
            width: 120%; height: 60%; 
            background: radial-gradient(circle, rgba(59,130,246,0.15) 0%, rgba(0,0,0,0) 70%);
            pointer-events: none; z-index: -1;
        }

        .container { width: 100%; max-width: 600px; padding: 20px 16px 80px; }

        /* === 1. Hero å¤´éƒ¨ (ä¿æŒ v12) === */
        .hero-section {
            text-align: center; margin-bottom: 30px; margin-top: 20px;
        }
        
        .hero-subtitle {
            color: var(--accent-blue);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem; letter-spacing: 2px; font-weight: 800;
            text-transform: uppercase; margin-bottom: 12px;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .hero-title {
            font-size: 2.2rem; line-height: 1.2; font-weight: 900; margin-bottom: 16px;
            color: #fff;
        }
        .hero-title .highlight {
            background: linear-gradient(90deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-size: 2.4rem; display: block; margin-top: 4px;
        }

        .hero-desc {
            font-size: 0.85rem; color: var(--text-sub); margin-bottom: 24px;
            line-height: 1.6; padding: 0 20px;
        }

        /* è¿›åº¦æ¡ */
        .progress-box {
            padding: 0 10px;
        }
        .progress-header {
            display: flex; justify-content: space-between; font-size: 0.75rem; 
            color: var(--text-sub); margin-bottom: 8px; font-weight: 600;
        }
        .progress-track {
            background: #1f1f1f; height: 12px; border-radius: 6px; overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        .progress-fill {
            height: 100%; background: linear-gradient(90deg, var(--accent-blue), #8b5cf6);
            width: 0%; transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1);
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.4);
        }

        /* === 2. åœ†å½¢ Tab å¯¼èˆª === */
        .nav-tabs {
            display: flex; justify-content: space-between; gap: 12px; margin-bottom: 24px; margin-top: 10px;
        }
        .nav-item {
            flex: 1; background: #161616; border: 1px solid #2a2a2a;
            border-radius: 16px; padding: 16px 0; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: all 0.3s; position: relative; overflow: hidden;
        }
        .nav-item.active {
            background: var(--accent-blue); border-color: var(--accent-blue);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
        }
        .nav-item.active .tab-week { color: rgba(255,255,255,0.8); }
        .nav-item.active .tab-num { color: #fff; }

        .tab-week { font-size: 0.7rem; font-weight: 700; color: #666; margin-bottom: 4px; text-transform: uppercase; }
        .tab-num { font-size: 1.4rem; font-weight: 900; color: #fff; font-family: 'JetBrains Mono'; line-height: 1; }

        /* === 3. å¯¼è¯­å¡ç‰‡ === */
        .week-banner {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px; padding: 24px; margin-bottom: 24px;
            position: relative; overflow: hidden;
            animation: slideUp 0.4s ease-out;
        }
        .week-banner::after {
            content: ''; position: absolute; right: -10px; bottom: -30px;
            width: 100px; height: 100px; background: rgba(59, 130, 246, 0.1);
            border-radius: 50%; filter: blur(20px);
        }
        .banner-tag {
            background: rgba(255,255,255,0.1); color: #a5b4fc; padding: 4px 8px;
            border-radius: 4px; font-size: 0.7rem; font-weight: 700; display: inline-block; margin-bottom: 12px;
        }
        .banner-title { font-size: 1.3rem; font-weight: 800; color: #fff; margin-bottom: 8px; }
        .banner-desc { font-size: 0.85rem; color: #94a3b8; line-height: 1.5; }

        /* ä»»åŠ¡åˆ—è¡¨ */
        .grid { display: grid; gap: 12px; display: none; }
        .grid.active { display: grid; animation: fadeIn 0.5s; }
        
        .card {
            background: #111; border: 1px solid #222; border-radius: 12px;
            padding: 18px; cursor: pointer; display: flex; align-items: center; justify-content: space-between;
            transition: all 0.2s; position: relative;
        }
        .card:active { transform: scale(0.98); background: #1a1a1a; }
        .card-left { display: flex; align-items: center; gap: 15px; }
        
        .day-badge {
            font-family: 'JetBrains Mono'; font-size: 0.75rem; color: #666; font-weight: 700;
            background: #1a1a1a; padding: 6px 8px; border-radius: 6px; min-width: 60px; text-align: center;
        }
        .card.completed .day-badge { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .card-title { font-size: 1rem; font-weight: 600; color: #eee; }
        .check-icon {
            width: 24px; height: 24px; border: 2px solid #444; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; transition: all 0.2s;
        }
        .card.completed .check-icon { border-color: var(--success); background: var(--success); }
        .card.completed .check-icon::after { content: 'âœ“'; color: #000; font-weight: 900; font-size: 14px; }

        /* Footer (Updated with Reset) */
        footer { margin-top: 60px; text-align: center; padding-top: 30px; border-top: 1px solid #222; padding-bottom: 30px; }
        
        .data-btn-group { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .pill-btn {
            background: #1a1a1a; border: 1px solid #333; color: #ccc;
            padding: 10px 20px; border-radius: 30px; font-size: 0.85rem; font-weight: 600;
            cursor: pointer; display: flex; align-items: center; gap: 6px; transition: 0.2s;
        }
        .pill-btn:active { background: #222; transform: scale(0.95); }
        
        /* å±é™©æŒ‰é’®æ ·å¼ */
        .danger-zone { margin-top: 25px; margin-bottom: 15px; }
        .btn-reset {
            background: transparent; border: 1px solid #ef4444; color: #ef4444;
            padding: 8px 16px; border-radius: 30px; font-size: 0.75rem; font-weight: 600;
            cursor: pointer; display: inline-flex; align-items: center; gap: 4px; transition: 0.2s; opacity: 0.7;
        }
        .btn-reset:hover { opacity: 1; background: rgba(239, 68, 68, 0.1); }
        
        .copyright { font-size: 0.7rem; color: #444; letter-spacing: 1px; }

        /* é‚€è¯·ç é¡µé¢ */
        .gate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #050505;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 999; padding: 30px;
        }
        .gate-logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem; font-weight: 800;
            color: #3b82f6; letter-spacing: 3px;
            text-transform: uppercase; margin-bottom: 28px;
            text-shadow: 0 0 10px rgba(59,130,246,0.5);
        }
        .gate-title {
            font-size: 1.5rem; font-weight: 900;
            color: #fff; text-align: center;
            margin-bottom: 10px; line-height: 1.3;
        }
        .gate-desc {
            font-size: 0.85rem; color: #666;
            text-align: center; margin-bottom: 32px; line-height: 1.6;
        }
        .gate-input {
            width: 100%; max-width: 320px;
            background: #111; border: 1px solid #333;
            border-radius: 12px; padding: 16px 18px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem; color: #fff;
            text-align: center; letter-spacing: 3px;
            outline: none; margin-bottom: 14px;
            transition: border-color 0.2s;
        }
        .gate-input:focus { border-color: #3b82f6; }
        .gate-input.error { border-color: #ef4444; animation: shake 0.3s ease; }
        .gate-btn {
            width: 100%; max-width: 320px;
            padding: 15px; border-radius: 12px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            color: #fff; font-size: 0.95rem; font-weight: 800;
            border: none; cursor: pointer;
            transition: opacity 0.2s, transform 0.2s;
        }
        .gate-btn:active { transform: scale(0.97); opacity: 0.9; }
        .gate-error {
            font-size: 0.8rem; color: #ef4444;
            margin-top: 12px; text-align: center; display: none;
        }
        .gate-error.show { display: block; }
        @keyframes shake {
            0%,100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        /* Modal Styles */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); z-index: 100; display: none; justify-content: center; align-items: end; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.open { display: flex; opacity: 1; }
        .modal-content { background: #161616; width: 100%; max-width: 600px; height: 92vh; border-radius: 24px 24px 0 0; border-top: 1px solid #333; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 -10px 40px rgba(0,0,0,0.8); }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 1.2rem; font-weight: 800; color: #fff; font-family: 'JetBrains Mono'; }
        .close-btn { background: none; border: none; color: #666; font-size: 28px; padding: 0; cursor: pointer; }
        .modal-body { flex: 1; overflow-y: auto; padding: 24px; padding-bottom: 60px; }
        .section-label { font-size: 0.75rem; color: var(--accent-blue); font-weight: 800; text-transform: uppercase; margin: 24px 0 10px; letter-spacing: 1px; }
        .section-label:first-child { margin-top: 0; }
        .task-box { background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); padding: 16px; border-radius: 12px; color: #e2e8f0; font-size: 0.95rem; line-height: 1.6; }
        .example-box { background: #0a0a0a; padding: 16px; border-radius: 12px; margin-top: 12px; font-size: 0.85rem; border-left: 3px solid var(--gold); }
        .homework-area, .revision-area { width: 100%; min-height: 150px; background: #0a0a0a; color: #fff; border: 1px solid #333; border-radius: 12px; padding: 16px; font-family: inherit; font-size: 16px; line-height: 1.6; resize: none; outline: none; margin-bottom: 8px; }
        .homework-area:focus, .revision-area:focus { border-color: var(--accent-blue); }
        .revision-area { background: #1a1500; border-color: rgba(245, 158, 11, 0.3); }
        .revision-area:focus { border-color: var(--gold); }
        .ai-prompt-box { background: #0d1117; border: 1px dashed #30363d; padding: 16px; border-radius: 12px; margin-top: 20px; display: none; }
        .ai-prompt-content { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: #8b949e; white-space: pre-wrap; line-height: 1.5; max-height: 150px; overflow-y: auto; }
        .btn-ai-gen { background: linear-gradient(90deg, #3b82f6, #8b5cf6); border: none; color: white; padding: 14px; border-radius: 12px; font-size: 0.95rem; font-weight: 700; width: 100%; margin-top: 15px; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-secondary { background: #21262d; color: #c9d1d9; border: 1px solid #30363d; padding: 10px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 0.85rem; }
        .btn-report { background: linear-gradient(90deg, #f59e0b, #d97706); color: #000; border: none; padding: 14px; border-radius: 12px; font-size: 1rem; font-weight: 800; width: 100%; margin-top: 30px; cursor: pointer; }
        .report-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 200; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .report-overlay.show { display: flex; }
        .report-img { max-width: 90%; max-height: 80vh; border-radius: 12px; border: 1px solid #333; }
        .report-close { position: absolute; top: 20px; right: 20px; color: #fff; font-size: 30px; cursor: pointer; z-index: 201; }
        .report-tip { color: var(--gold); margin-top: 20px; font-size: 0.8rem; font-weight: 600; animation: pulse 2s infinite; }
        #canvas-buffer { display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

        /* å¾®ä¿¡æç¤ºæ¨ªå¹… */
        .wechat-tip {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; z-index: 9999;
            background: #f0a500; color: #000;
            padding: 14px 16px;
            font-size: 14px; font-weight: 700;
            text-align: center; line-height: 1.5;
            -webkit-box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .wechat-tip.show { display: block; }

        /* textarea ç»Ÿä¸€ 16px é˜² iOS è‡ªåŠ¨ç¼©æ”¾ */
        textarea { font-size: 16px !important; }

        /* ç»“è¥é¡¹ç›®æ ·å¼ */
        .grad-section { background: linear-gradient(145deg, #0f1729, #0d1320); border: 1px solid rgba(59,130,246,0.15); border-radius: 16px; padding: 24px; margin-top: 20px; margin-bottom: 16px; }
        .grad-section-title { font-size: 0.75rem; font-weight: 800; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px; display: flex; align-items: center; gap: 6px; }
        .grad-example-block { background: rgba(0,0,0,0.3); border-left: 3px solid var(--gold); border-radius: 0 8px 8px 0; padding: 14px 16px; margin-bottom: 12px; font-size: 0.85rem; color: #cbd5e1; line-height: 1.8; }
        .grad-example-block:last-child { margin-bottom: 0; }
        .grad-step-label { font-size: 0.7rem; color: var(--gold); font-weight: 700; margin-bottom: 6px; }
        .grad-standard { background: #0f1a0f; border: 1px solid rgba(16,185,129,0.2); border-radius: 16px; padding: 24px; margin-bottom: 16px; }
        .grad-standard-title { font-size: 0.75rem; font-weight: 800; color: #10b981; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px; }
        .grad-standard-item { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 12px; font-size: 0.88rem; color: #94a3b8; line-height: 1.6; }
        .grad-standard-item:last-child { margin-bottom: 0; }
        .grad-standard-dot { width: 6px; height: 6px; background: #10b981; border-radius: 50%; margin-top: 8px; flex-shrink: 0; }
        .btn-guide { width: 100%; padding: 16px; border-radius: 14px; font-size: 1rem; font-weight: 800; cursor: pointer; border: none; background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)); color: #fff; margin-top: 20px; margin-bottom: 12px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: opacity 0.2s, transform 0.2s; }
        .btn-guide:active { transform: scale(0.98); opacity: 0.9; }
        .guide-result { background: #0a0a0a; border: 1px solid #2a2a2a; border-radius: 14px; padding: 20px; margin-bottom: 16px; display: none; }
        .guide-result.show { display: block; animation: fadeIn 0.4s ease; }
        .guide-result-label { font-size: 0.7rem; font-weight: 800; color: var(--accent-purple); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
        .guide-result-text { font-size: 0.92rem; color: #e2e8f0; line-height: 1.9; white-space: pre-line; }
        .btn-guide-copy { width: 100%; padding: 14px; border-radius: 14px; font-size: 0.95rem; font-weight: 700; cursor: pointer; border: 1px solid #333; background: #1a1a1a; color: #ccc; display: none; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; margin-bottom: 16px; }
        .btn-guide-copy:active { background: #222; transform: scale(0.98); }
        .grad-deadline { background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.25); border-radius: 12px; padding: 14px 18px; display: flex; align-items: center; gap: 10px; margin-top: 20px; margin-bottom: 16px; font-size: 0.85rem; color: var(--gold); font-weight: 600; }
    </style>
</head>
<body>

<!-- å¾®ä¿¡å†…æ‰“å¼€æç¤º -->
<div class="wechat-tip" id="wechat-tip">
    âš ï¸ è¯·ç‚¹å³ä¸Šè§’ã€ŒÂ·Â·Â·ã€â†’ã€Œåœ¨æµè§ˆå™¨æ‰“å¼€ã€ï¼ŒåŠŸèƒ½æ‰èƒ½æ­£å¸¸ä½¿ç”¨
</div>

    <div class="container" id="main-content">
        <div class="hero-section">
            <div class="hero-subtitle">21-DAY EVOLUTION</div>
            <div class="hero-title">
                ä»â€œè¯­æ— ä¼¦æ¬¡â€åˆ°<span class="highlight">â€œé€»è¾‘å¤§ç¥â€</span>
            </div>
            <div class="hero-desc">
                21å¤©æ€ç»´è¡¨è¾¾è¿›åŒ–è®­ç»ƒè¥ï¼šå…ˆè¯´äººè¯ï¼Œå†è¯´ç»“æ„ï¼Œæœ€åæ´å¯Ÿã€‚
            </div>
            
            <div class="progress-box">
                <div class="progress-header">
                    <span>æ€»è¿›åº¦</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="progress-bar"></div>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="nav-item active" onclick="switchWeek(1)" id="tab-1">
                <div class="tab-week">Week</div>
                <div class="tab-num">1</div>
            </div>
            <div class="nav-item" onclick="switchWeek(2)" id="tab-2">
                <div class="tab-week">Week</div>
                <div class="tab-num">2</div>
            </div>
            <div class="nav-item" onclick="switchWeek(3)" id="tab-3">
                <div class="tab-week">Week</div>
                <div class="tab-num">3</div>
            </div>
            <div class="nav-item" onclick="switchWeek(4)" id="tab-4">
                <div class="tab-week">Final</div>
                <div class="tab-num">ğŸ“</div>
            </div>
        </div>

        <div id="week-banner" class="week-banner">
            </div>

        <div id="content-area"></div>
    </div>

    <footer>
        <div class="data-btn-group">
            <button class="pill-btn" onclick="copyDataString(this)">
                <span style="color:#f59e0b">ğŸ“‹</span> å¤‡ä»½è¿›åº¦
            </button>
            <button class="pill-btn" onclick="pasteDataString()">
                <span style="color:#a78bfa">ğŸ“¥</span> æ¢å¤è¿›åº¦
            </button>
            <button class="pill-btn" onclick="exportCalendar(this)">
                <span style="color:#10b981">ğŸ“…</span> å¯¼å‡ºæ—¥å†
            </button>
        </div>
        <div style="font-size: 0.75rem; color: #666; margin-bottom: 6px;">*æœ¬åœ°ç¦»çº¿ç³»ç»Ÿï¼Œè¯·è®°å¾—å®šæœŸå¤‡ä»½</div>
        <div style="font-size: 0.72rem; color: #555;">ğŸ“… å¯¼å‡ºæ—¥å†ï¼šä¸‹è½½ .ics æ–‡ä»¶åï¼Œç”¨æ‰‹æœº"æ–‡ä»¶"app ç‚¹å‡»å³å¯å¯¼å…¥ç³»ç»Ÿæ—¥å†</div>

        <div class="danger-zone">
            <button class="btn-reset" onclick="resetData()">
                <span>â†»</span> æ¸…ç©ºè®°å½•é‡æ–°å¼€å§‹
            </button>
        </div>

        <div class="copyright">Â© èˆŸèˆŸçš„æ€ç»´è¿›åŒ–ç³»ç»Ÿ | æœ¬åœ°æ•°æ®å·²å¯ç”¨</div>
    </footer>

    <div class="modal-overlay" id="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title" id="m-title">Day X</div>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="section-label">ğŸ¯ ä»Šæ—¥å®æˆ˜ (Daily Task)</div>
                <div class="task-box">
                    <div id="m-task" style="margin-bottom:10px;">...</div>
                </div>
                <div class="example-box">
                    <div style="color:var(--gold); font-weight:bold; margin-bottom:4px;">ğŸ’¡ æŠ€å·§æç¤º:</div>
                    <div id="m-example" style="color:#aaa; white-space:pre-wrap;">...</div>
                </div>

                <div class="section-label" style="color: #a78bfa;">ğŸ—£ï¸ åˆç¨¿ (V1.0)</div>
                <textarea id="m-input" class="homework-area" placeholder="ç‚¹å‡»éº¦å…‹é£ï¼Œå£è¿°ä½ çš„æƒ³æ³•..."></textarea>
                
                <button class="btn-ai-gen" onclick="generateAiPrompt()">
                    <span>âœ¨ å‘¼å« AI æ•™ç»ƒä¼˜åŒ–é€»è¾‘</span>
                </button>
                
                <div class="ai-prompt-box" id="ai-box">
                    <div style="color:#888; font-size:0.7rem; margin-bottom:8px;">æŒ‡ä»¤å·²ç”Ÿæˆï¼š</div>
                    <div class="ai-prompt-content" id="ai-prompt-text"></div>
                    <div class="btn-group">
                        <button class="btn-secondary" onclick="forceCopy(this)">ğŸ“‹ ä»…å¤åˆ¶</button>
                        <button class="btn-secondary" style="background:#fff; color:#000;" onclick="jumpToDoubao(this)">ğŸš€ å»è±†åŒ… APP</button>
                    </div>
                </div>

                <div class="section-label" style="color: var(--gold); margin-top:30px;">ğŸ† å¤§å¸ˆæˆå“ (V2.0)</div>
                <textarea id="m-revision" class="revision-area" placeholder="AI ä¼˜åŒ–åçš„é€»è¾‘ç‰ˆæœ¬..."></textarea>
                <div id="save-msg" style="text-align:right; color:#666; font-size:0.7rem; margin-top:4px;">å·²ä¿å­˜</div>

                <button class="btn-report" onclick="generateVisualReport()">
                    ğŸ“¸ ç”Ÿæˆå®æˆ˜æˆ˜æŠ¥
                </button>
                <div style="height:40px"></div>
            </div>
        </div>
    </div>

    <div class="report-overlay" id="report-overlay">
        <div class="report-close" onclick="closeReport()">Ã—</div>
        <img id="report-img" class="report-img" alt="Report">
        <div class="report-tip">é•¿æŒ‰å›¾ç‰‡ä¿å­˜ -> ç§€å‡ºä½ çš„é€»è¾‘</div>
        <button id="btn-download-img" onclick="downloadReportImg()" style="margin-top:12px;padding:10px 28px;background:var(--gold);color:#000;border:none;border-radius:8px;font-size:0.85rem;font-weight:700;cursor:pointer;">ğŸ“¥ ä¿å­˜å›¾ç‰‡åˆ°æ‰‹æœº</button>
    </div>
    <canvas id="canvas-buffer" width="1080" height="1440"></canvas>

    <script>
        // ===== å¾®ä¿¡å†…ç½®æµè§ˆå™¨æ£€æµ‹ =====
        (function detectWechat() {
            var ua = navigator.userAgent.toLowerCase();
            if (ua.indexOf('micromessenger') !== -1) {
                document.getElementById('wechat-tip').classList.add('show');
                // ç»™é¡µé¢é¡¶éƒ¨ç•™å‡ºæç¤ºæ¡çš„ç©ºé—´
                document.body.style.paddingTop = '56px';
            }
        })();

        // ===== localStorage å®‰å…¨å°è£…ï¼ˆå…¼å®¹ iOS Safari éšç§æ¨¡å¼ï¼‰=====
        var LS = (function() {
            var mem = {};
            function isAvailable() {
                try { localStorage.setItem('__t', '1'); localStorage.removeItem('__t'); return true; } catch(e) { return false; }
            }
            var ok = isAvailable();
            return {
                get: function(k) { return ok ? localStorage.getItem(k) : (mem[k] || null); },
                set: function(k, v) { if (ok) { localStorage.setItem(k, v); } else { mem[k] = v; } },
                remove: function(k) { if (ok) { localStorage.removeItem(k); } else { delete mem[k]; } }
            };
        })();

        // ===== é‚€è¯·ç å·²ç§»é™¤ï¼Œç›´æ¥å±•ç¤ºå†…å®¹ =====

        // === æ ¸å¿ƒæ•°æ® ===
        const syllabus = {
            1: {
                title: "è§‚ç‚¹è®­ç»ƒï¼šè¯´äººè¯",
                goal: "æœ¬å‘¨ç›®æ ‡ï¼šä¸€å¥è¯è®²æ¸…æ¥šäº‹ (ä¿¡æ¯å‹ç¼© + è§‚ç‚¹è¾“å‡º)ï¼Œæ‹’ç»å•°å—¦ã€‚",
                days: [
                { day: 1, title: "æœ‰æ•ˆåæ§½", model: "SCQA-Conflict", task: "ã€åœºæ™¯ï¼šåæ§½ä¸€ä»¶çƒ¦å¿ƒäº‹ã€‘\nä»Šå¤©é‡åˆ°ä»€ä¹ˆä¸çˆ½çš„äº‹äº†ï¼Ÿè¯•ç€æŠŠå®ƒè¯´æ¸…æ¥šã€‚\nä¸è¦åªè¯´'æ°”æ­»æˆ‘äº†'ï¼Œè¦è¯´æ¸…æ¥šã€æœ¬æ¥åº”è¯¥æ˜¯æ€æ ·(S)ã€‘ï¼Œã€å®é™…å‘ç”Ÿäº†ä»€ä¹ˆå†²çª(C)ã€‘ï¼Œã€ä½ å¸Œæœ›æ€ä¹ˆè§£å†³(A)ã€‘ã€‚", example: "æŠ€å·§ï¼šç”¨ SCQA è®²æ•…äº‹ã€‚\næ¯”å¦‚ï¼š'æœ¬æ¥æˆ‘å’Œè€å…¬çº¦å¥½å»åƒé¥­(S)ï¼Œç»“æœä»–ä¸´æ—¶åŠ ç­(C)ï¼Œæˆ‘å¾ˆå¤±è½ï¼Œå¸Œæœ›ä¸‹æ¬¡èƒ½è¡¥ä¸Š(A)ã€‚'", template: "æœ¬æ¥æ˜¯ï¼š\nä½†æ˜¯ï¼š\næ‰€ä»¥æˆ‘æƒ³ï¼š" },
                { day: 2, title: "ç–¯ç‹‚å®‰åˆ©", model: "SCQA-Answer", task: "ã€åœºæ™¯ï¼šå®‰åˆ©ä¸€æ¬¾å¥½ç‰©/å‰§ã€‘\nå‘é—ºèœœæ¨èä¸€ä¸ªä½ æœ€è¿‘çˆ±ç”¨çš„ä¸œè¥¿ã€‚\nå…ˆç›´æ¥è¯´ã€å®ƒæœ‰å¤šå¥½(A)ã€‘ï¼Œå†è¯´ã€å¤§å®¶å¹³æ—¶çš„ç—›ç‚¹(C)ã€‘ï¼Œæœ€åè¯´ã€ä¸ºä»€ä¹ˆå®ƒèƒ½è§£å†³(Q-A)ã€‘ã€‚", example: "æŠ€å·§ï¼šç»“è®ºå…ˆè¡Œ(A-S-C-Q)ã€‚\næ¯”å¦‚ï¼š'è¿™æ¬¾é¢éœœç»äº†(A)ï¼ä»¥å‰æˆ‘è„¸æ€»å¹²(C)ï¼Œç”¨äº†å¾ˆå¤šéƒ½ä¸è¡Œï¼Œç›´åˆ°ç”¨äº†å®ƒ(S)...'", template: "æˆ‘è¦å¹çˆ†è¿™ä¸ªï¼š\nå¤§å®¶å¹³æ—¶æ˜¯ä¸æ˜¯æ€»ï¼š\nä½†å®ƒèƒ½ï¼š" },
                { day: 3, title: "è‡ªæˆ‘ä»‹ç»", model: "SCQA-Intro", task: "ã€åœºæ™¯ï¼šæ–°ç¾¤ç ´å†°ã€‘\nè¿›å…¥ä¸€ä¸ªæ–°çš„ç¤¾ç¾¤ï¼Œåšä¸€ä¸ªè®©äººè®°ä½çš„è‡ªæˆ‘ä»‹ç»ã€‚\nåˆ«åªæŠ¥åå­—ï¼Œè¯´è¯´ã€ä½ æ˜¯è°(S)ã€‘ï¼Œã€ä½ æ­£åœ¨ç»å†ä»€ä¹ˆæŒ‘æˆ˜/æ¢ç´¢(C)ã€‘ï¼Œã€ä½ èƒ½ç»™å¤§å®¶å¸¦æ¥ä»€ä¹ˆ(A)ã€‘ã€‚", example: "æŠ€å·§ï¼šç”¨æ•…äº‹åŒ…è£…èº«ä»½ã€‚\næ¯”å¦‚ï¼š'æˆ‘æ˜¯å¸¦å¨ƒ5å¹´çš„å®å¦ˆ(S)ï¼Œä¸æƒ³ä¸ç¤¾ä¼šè„±èŠ‚(C)ï¼Œç°åœ¨æ­£åœ¨å­¦ä¹ AIå†™ä½œ(A)ã€‚'", template: "æˆ‘æ˜¯è°ï¼š\næˆ‘æ­£åœ¨é¢ä¸´/æ¢ç´¢ï¼š\næˆ‘èƒ½åˆ†äº«ï¼š" },
                { day: 4, title: "é«˜æƒ…å•†æ‹’ç»", model: "SCQA-Refuse", task: "ã€åœºæ™¯ï¼šæ‹’ç»ä¸åˆç†è¦æ±‚ã€‘\næœ‹å‹å€Ÿé’±ã€åŒäº‹ç”©é”…ï¼Ÿè¯•ç€å§”å©‰ä½†åšå®šåœ°æ‹’ç»ã€‚\nå…ˆã€è‚¯å®šå¯¹æ–¹/è¡¨ç¤ºæ„Ÿè°¢(S)ã€‘ï¼Œå†è¯´ã€è‡ªå·±çš„éš¾å¤„(C)ã€‘ï¼Œæœ€åã€ç»™ä¸ªå°é˜¶/æ›¿ä»£æ–¹æ¡ˆ(A)ã€‘ã€‚", example: "æŠ€å·§ï¼šS(ç¼“å†²)-C(ç†ç”±)-A(æ‹’ç»)ã€‚\næ¯”å¦‚ï¼š'è°¢è°¢ä½ æƒ³åˆ°æˆ‘(S)ï¼Œä½†æˆ‘æœ€è¿‘æ‰‹å¤´ä¹Ÿç´§(C)ï¼Œç¡®å®æ²¡æ³•å€Ÿï¼ŒæŠ±æ­‰å•Š(A)ã€‚'", template: "è°¢è°¢ä½ ï¼š\nä½†æ˜¯æˆ‘ç°åœ¨ï¼š\næ‰€ä»¥æ¯”è¾ƒæŠ±æ­‰ï¼š" },
                { day: 5, title: "å‘æœ‹å‹åœˆ", model: "SCQA-Moment", task: "ã€åœºæ™¯ï¼šè®°å½•ç”Ÿæ´»æ„Ÿæ‚Ÿã€‘\nå‘ä¸€æ¡æœ‰æ·±åº¦çš„æœ‹å‹åœˆã€‚\nå…ˆæè¿°ã€ä¸€ä¸ªç°è±¡(S)ã€‘ï¼Œå†æŒ‡å‡ºã€å¤§å¤šæ•°äººçš„è¯¯åŒº(C)ã€‘ï¼Œæœ€åäº®å‡ºã€ä½ çš„ç‹¬ç‰¹è§‚ç‚¹(A)ã€‘ã€‚", example: "æŠ€å·§ï¼šåˆ¶é€ åå·®ã€‚\næ¯”å¦‚ï¼š'å¤§å®¶éƒ½è§‰å¾—èººå¹³å¾ˆçˆ½(S)ï¼Œå…¶å®èººå¹³æ›´ç„¦è™‘(C)ï¼ŒçœŸæ­£çš„æ¾å¼›æ„Ÿæ˜¯æŒæ§åŠ›(A)ã€‚'", template: "å¤§å®¶é€šå¸¸è§‰å¾—ï¼š\nä½†å…¶å®ï¼š\næˆ‘è®¤ä¸ºï¼š" },
                { day: 6, title: "å“„äºº/æ±‚å’Œ", model: "SCQA-Peace", task: "ã€åœºæ™¯ï¼šè§£å†³å†·æˆ˜ã€‘\næƒ¹äººç”Ÿæ°”äº†æ€ä¹ˆå“„ï¼Ÿ\nå…ˆæ‰¿è®¤ã€æˆ‘ä»¬çš„å…³ç³»å¾ˆé‡è¦(S)ã€‘ï¼Œå†æ‰¿è®¤ã€åˆšæ‰çš„é—®é¢˜(C)ã€‘ï¼Œæœ€åæå‡ºã€è¡¥æ•‘æªæ–½(A)ã€‘ã€‚", example: "æŠ€å·§ï¼šS(å…±åŒç›®æ ‡)-C(ç¡®è®¤å†²çª)-A(è¡ŒåŠ¨)ã€‚\næ¯”å¦‚ï¼š'æˆ‘ä»¬åˆ«åµäº†(S)ï¼Œåˆšæ‰æ˜¯æˆ‘è¯­æ°”é‡äº†(C)ï¼Œå¸¦ä½ å»åƒç«é”…å§(A)ã€‚'", template: "æˆ‘ä»¬æœ¬æ„æ˜¯ï¼š\nåˆšæ‰ç¡®å®ï¼š\nä¸å¦‚æˆ‘ä»¬ï¼š" },
                { day: 7, title: "æœ¬å‘¨å¤ç›˜", model: "Review", task: "ã€åœºæ™¯ï¼šè·Ÿè‡ªå·±å¯¹è¯ã€‘\nè¿™å‘¨è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ\nã€S:è®¡åˆ’ã€‘vsã€C:å®é™…å˜åŒ–ã€‘vsã€A:ä¸‹å‘¨è°ƒæ•´ã€‘ã€‚", example: "æŠ€å·§ï¼šSCQAå¤ç›˜æ³•ã€‚", template: "æœ¬å‘¨åŸæœ¬è®¡åˆ’ï¼š\nä¸­é—´é‡åˆ°äº†ï¼š\nä¸‹å‘¨å†³å®šï¼š" }
            ]},
            2: {
                title: "ç»“æ„è®­ç»ƒï¼šæœ‰é€»è¾‘",
                goal: "æœ¬å‘¨ç›®æ ‡ï¼šæ­å»ºæ€ç»´éª¨æ¶ï¼Œè®©è¡¨è¾¾ç«™å¾—ä½è„šï¼Œä¸å†è¯­æ— ä¼¦æ¬¡ã€‚",
                days: [
                { day: 8, title: "åˆ—æ¸…å•", model: "Structure-List", task: "ã€åœºæ™¯ï¼šå‘¨æœ«è®¡åˆ’ã€‘\nè¿™ä¸ªå‘¨æœ«æƒ³åšä»€ä¹ˆï¼Ÿä¸è¦ä¹±æƒ³ï¼Œåˆ—å‡º 3 ä»¶äº‹ã€‚\næŠ€å·§ï¼šè¿™å°±æ˜¯â€œå½’çº³æ³•â€ã€‚", example: "1. ä¼‘æ¯ç±»ï¼ˆç¡æ‡’è§‰ï¼‰\n2. ç¤¾äº¤ç±»ï¼ˆèšé¤ï¼‰\n3. å­¦ä¹ ç±»ï¼ˆçœ‹ä¹¦ï¼‰", template: "å‘¨æœ«æˆ‘æƒ³åšä¸‰ä»¶äº‹ï¼š\n1.\n2.\n3." },
                { day: 9, title: "åšé€‰æ‹©", model: "Structure-Choice", task: "ã€åœºæ™¯ï¼šä¹°ä¸ä¹°ï¼Ÿã€‘\nçœ‹ä¸­äº†ä¸€ä¸ªè´µä¸œè¥¿ï¼Œçº ç»“ä¹°ä¸ä¹°ï¼Ÿ\nåˆ—å‡ºã€ä¹°çš„ç†ç”±ã€‘vsã€ä¸ä¹°çš„ç†ç”±ã€‘ï¼Œæœ€åç»™ç»“è®ºã€‚", example: "æŠ€å·§ï¼šæ­£åè®ºè¯ã€‚\næ­£é¢ï¼šåˆ©ç”¨ç‡é«˜ï¼›åé¢ï¼šè¶…é¢„ç®—ã€‚", template: "æˆ‘æƒ³ä¹°ï¼š\næ”¯æŒç†ç”±ï¼š\nåå¯¹ç†ç”±ï¼š\næœ€ç»ˆå†³å®šï¼š" },
                { day: 10, title: "æ•™åˆ«äºº", model: "Structure-Steps", task: "ã€åœºæ™¯ï¼šæ•™çˆ¸å¦ˆç”¨æ‰‹æœº/åšèœã€‘\nè¦æŠŠä¸€ä¸ªæ­¥éª¤è®²æ¸…æ¥šã€‚\nç”¨â€œç¬¬ä¸€æ­¥ã€ç¬¬äºŒæ­¥ã€ç¬¬ä¸‰æ­¥â€çš„é¡ºåºã€‚", example: "æŠ€å·§ï¼šæ—¶é—´é¡ºåºã€‚\n1. å…ˆæ‰“å¼€è®¾ç½®ï¼›2. å†ç‚¹æ˜¾ç¤ºï¼›3. è°ƒå¤§å­—ä½“ã€‚", template: "æ•™ä½ åš/ç”¨è¿™ä¸ªï¼š\nç¬¬ä¸€æ­¥ï¼š\nç¬¬äºŒæ­¥ï¼š\nç¬¬ä¸‰æ­¥ï¼š" },
                { day: 11, title: "è°ˆåŠ è–ª/è°ˆæ¡ä»¶", model: "Structure-Value", task: "ã€åœºæ™¯ï¼šè°ˆåˆ©ç›Šã€‘\næƒ³è®©è€å…¬åšå®¶åŠ¡ï¼Ÿæˆ–è€…è·Ÿè€æ¿è°ˆèµ„æºï¼Ÿ\nå‘Šè¯‰ä»–ï¼šè¿™æ ·åšã€å¯¹ä½ æœ‰ä»€ä¹ˆå¥½å¤„(WIIFM)ã€‘ã€‚", example: "æŠ€å·§ï¼šåˆ©ç›Šé©±åŠ¨ã€‚\n'è€å…¬ä½ æŠŠåœ°æ‰«äº†ï¼Œæˆ‘å°±èƒ½è…¾å‡ºæ‰‹ç»™ä½ åšçº¢çƒ§è‚‰äº†ã€‚'", template: "æˆ‘æƒ³è®©ä½ åšï¼š\nè¿™æ ·åšå¯¹ä½ çš„å¥½å¤„æ˜¯ï¼š" },
                { day: 12, title: "è¯„ä»·äº‹ç‰©", model: "Structure-Aspects", task: "ã€åœºæ™¯ï¼šè¯„ä»·ä¸€ä¸ªé¤å…/ç”µå½±ã€‘\nä¸è¦åªè¯´â€œå¥½åƒ/å¥½çœ‹â€ã€‚\nè¯•ç€ä» 3 ä¸ªç»´åº¦è¯„ä»·ï¼ˆå¦‚ï¼šç¯å¢ƒã€æœåŠ¡ã€å£å‘³ï¼‰ã€‚", example: "æŠ€å·§ï¼šç»“æ„åŒ–æ€ç»´(MECE)ã€‚", template: "è¯„ä»·ï¼š\n1. ç»´åº¦ä¸€ï¼š\n2. ç»´åº¦äºŒï¼š\n3. ç»´åº¦ä¸‰ï¼š" },
                { day: 13, title: "è®²é“ç†", model: "Structure-Logic", task: "ã€åœºæ™¯ï¼šè¯´æœåˆ«äººã€‘\nç”¨â€œå› ä¸º...æ‰€ä»¥...â€çš„é€»è¾‘è¯´æœä¸€ä¸ªäººã€‚\næ¯”å¦‚åŠäººæ—©ç¡ï¼ŒåŠäººè¯»ä¹¦ã€‚", example: "æŠ€å·§ï¼šæ¼”ç»æ¨ç†ã€‚\n'ç†¬å¤œä¼šå˜ä¸‘(å¤§å‰æ)ï¼Œä½ ä¸æƒ³å˜ä¸‘(å°å‰æ)ï¼Œæ‰€ä»¥ä½ è¦æ—©ç¡(ç»“è®º)ã€‚'", template: "æˆ‘å»ºè®®ä½ ï¼š\nå› ä¸ºä¸€ï¼š\nå› ä¸ºäºŒï¼š\næ‰€ä»¥ï¼š" },
                { day: 14, title: "ç»“æ„åŒ–æ€»ç»“", model: "Review", task: "ã€åœºæ™¯ï¼šå‘¨è®°ã€‘\nç”¨â€œæ€»-åˆ†â€ç»“æ„å†™è¿™å‘¨çš„æ€»ç»“ã€‚\nå…ˆè¯´ä¸€ä¸ªæ ¸å¿ƒè¯ï¼Œå†è¯´ä¸‰ä»¶å°äº‹ã€‚", example: "æ ¸å¿ƒè¯ï¼šå¿™ç¢Œã€‚\n1. å·¥ä½œå¿™ï¼›2. å®¶é‡Œå¿™ï¼›3. å¿ƒé‡Œå¿™ã€‚", template: "æœ¬å‘¨å…³é”®è¯ï¼š\nå…·ä½“è¡¨ç°1ï¼š\nå…·ä½“è¡¨ç°2ï¼š\nå…·ä½“è¡¨ç°3ï¼š" }
            ]},
            3: {
                title: "æ´å¯Ÿè®­ç»ƒï¼šé«˜çº§æ„Ÿ",
                goal: "æœ¬å‘¨ç›®æ ‡ï¼šé€è¿‡ç°è±¡çœ‹æœ¬è´¨ï¼Œç”¨ç±»æ¯”å’Œé‡‘å¥è®©ä½ çš„è¡¨è¾¾é—ªé—ªå‘å…‰ã€‚",
                days: [
                { day: 15, title: "æ‰“æ¯”æ–¹", model: "Analogy-Life", task: "ã€åœºæ™¯ï¼šè§£é‡Šå¿ƒæƒ…ã€‘\nä½ ç°åœ¨æ˜¯ä»€ä¹ˆå¿ƒæƒ…ï¼Ÿ\nè¯•ç€ç”¨â€œå°±åƒ......â€æ¥å½¢å®¹å®ƒã€‚", example: "æŠ€å·§ï¼šç±»æ¯”ã€‚\n'æˆ‘ç´¯å¾—å°±åƒä¸€æ¡åˆšè·‘å®Œé©¬æ‹‰æ¾çš„ç‹—ã€‚'", template: "æˆ‘ç°åœ¨æ„Ÿè§‰ï¼š\nå°±åƒï¼š" },
                { day: 16, title: "è®²æ•…äº‹", model: "Story-Moment", task: "ã€åœºæ™¯ï¼šåˆ†äº«ç»å†ã€‘\nè®²ä¸€ä¸ªä½ è¿‡å»çš„â€œé«˜å…‰æ—¶åˆ»â€æˆ–â€œè‡³æš—æ—¶åˆ»â€ã€‚\nè¦æœ‰ç”»é¢æ„Ÿã€‚", example: "æŠ€å·§ï¼šSTARæ³•åˆ™ï¼ˆæƒ…å¢ƒ-ä»»åŠ¡-è¡ŒåŠ¨-ç»“æœï¼‰ã€‚", template: "é‚£æ˜¯ä¸€æ¬¡ï¼š\nå½“æ—¶æƒ…å†µæ˜¯ï¼š\næˆ‘åšäº†ï¼š\næœ€åï¼š" },
                { day: 17, title: "è¯´é‡‘å¥", model: "Golden-Word", task: "ã€åœºæ™¯ï¼šé¼“åŠ±æœ‹å‹ã€‘\næœ‹å‹emoäº†ï¼Œé€ä»–ä¸€å¥æœ‰åŠ›é‡çš„è¯ã€‚\nè¯•ç€æŠ¼éŸµï¼Œæˆ–è€…ç”¨å¯¹æ¯”ã€‚", example: "æŠ€å·§ï¼šé‡‘å¥æç‚¼ã€‚\n'ä¸‡ç‰©çš†æœ‰è£‚ç—•ï¼Œé‚£æ˜¯å…‰ç…§è¿›æ¥çš„åœ°æ–¹ã€‚'", template: "æƒ³å¯¹ä½ è¯´ï¼š\n" },
                { day: 18, title: "ç¥é¢„è¨€", model: "Insight-Future", task: "ã€åœºæ™¯ï¼šèŠè¶‹åŠ¿ã€‘\nèŠèŠä½ å¯¹æŸä¸ªè¡Œä¸šï¼ˆå¦‚AIã€çŸ­è§†é¢‘ï¼‰çš„çœ‹æ³•ã€‚\nç”¨â€œæˆ‘è®¤ä¸ºæœªæ¥......â€å¼€å¤´ã€‚", example: "æŠ€å·§ï¼šæ´å¯ŸåŠ›ã€‚", template: "å…³äºè¿™ä¸ªè¡Œä¸šï¼š\næˆ‘è®¤ä¸ºæœªæ¥ä¼šï¼š" },
                { day: 19, title: "æ‰å¿ƒçœŸç›¸", model: "Insight-Truth", task: "ã€åœºæ™¯ï¼šæ­éœ²æœ¬è´¨ã€‘\né€è¿‡ç°è±¡çœ‹æœ¬è´¨ã€‚\nâ€œè¡¨é¢ä¸Šæ˜¯Aï¼Œå®é™…ä¸Šæ˜¯Bâ€ã€‚", example: "æŠ€å·§ï¼šæ·±åº¦æ€è€ƒã€‚\n'è¡¨é¢ä¸Šæ˜¯æ‹–å»¶ï¼Œå®é™…ä¸Šæ˜¯ææƒ§å¤±è´¥ã€‚'", template: "è¡¨é¢ä¸Šï¼š\nå®é™…ä¸Šï¼š" },
                { day: 20, title: "è¡ŒåŠ¨å·å¬", model: "Call-Action", task: "ã€åœºæ™¯ï¼šçº¦äººã€‘\nçº¦æœ‹å‹å‡ºæ¥ç©ï¼Œæˆ–è€…å·å¬å¤§å®¶ä¸€èµ·åšä»¶äº‹ã€‚\nç»™å‡ºä¸€ä¸ªæ— æ³•æ‹’ç»çš„ç†ç”±ã€‚", example: "æŠ€å·§ï¼šCTA (Call To Action)ã€‚", template: "æˆ‘ä»¬ä¸€èµ·å»ï¼š\nå¦‚æœä¸å»ä¼šåæ‚”ï¼Œå› ä¸ºï¼š" },
                { day: 21, title: "æ¯•ä¸šæ„Ÿè¨€", model: "Final-Speech", task: "ã€åœºæ™¯ï¼šå®Œç»“æ’’èŠ±ã€‘\n21å¤©ç»“æŸäº†ï¼Œå¯¹è‡ªå·±è¯´ä¸€æ®µè¯ã€‚\nç”¨ä¸ŠSCQAï¼ŒåŠ ä¸Šæ’æ¯”å¥ã€‚", example: "S(å¼€å§‹å¾ˆéš¾)-C(ä¸­é—´å¾ˆç´¯)-A(ä½†æˆ‘åšæŒä¸‹æ¥äº†)ã€‚", template: "å¯¹è‡ªå·±è¯´ï¼š" }
            ]},
            4: {
                title: "ç»“è¥é¡¹ç›®ï¼šæˆ‘æ˜¯è°çš„å‘å¯¼ï¼Ÿ",
                goal: '21å¤©ä½ ç»ƒçš„æ˜¯"è¯´æ¸…æ¥šä¸€ä»¶äº‹"ã€‚ç»“è¥é¡¹ç›®åªé—®ä½ ä¸€ä¸ªé—®é¢˜ï¼šä½ èƒ½å¸®ä»€ä¹ˆäººï¼Œè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ',
                days: [
                { day: 22, title: "æ‰¾åˆ°ä½ çš„è‹±é›„", model: "Graduation-Hero", task: 'ã€Step 1ï¼šæ‰¾åˆ°ä½ çš„è‹±é›„ã€‘\nä»–æ˜¯è°ï¼Ÿä»–æ¯å¤©åœ¨é¢å¯¹ä»€ä¹ˆå›°å¢ƒï¼Ÿ\nä¸è¦è¯´"æ‰€æœ‰äºº"ï¼Œè¯´ä¸€ä¸ªå…·ä½“çš„äººã€‚', example: "èˆŸèˆŸçš„ç¤ºèŒƒï¼š\næœ‰ä¸€ç§äººï¼Œæ¯å¤©éƒ½æœ‰å¾ˆå¤šæƒ³æ³•ï¼Œä½†ä¸€å¼€å£å°±è¯­æ— ä¼¦æ¬¡ï¼Œå†™å‡ºæ¥è‡ªå·±éƒ½çœ‹ä¸æ‡‚ã€‚ä»–ä»¬æœ€å¤§çš„å›°å¢ƒä¸æ˜¯æ²¡ä¸œè¥¿è¯´ï¼Œè€Œæ˜¯è¯´äº†åˆ«äººä¸æ‡‚ã€å†™äº†æ²¡äººçœ‹ã€‚å†…å¿ƒæ·±å¤„ï¼Œä»–ä»¬çœŸæ­£å®³æ€•çš„æ˜¯ï¼šæˆ‘è¯´çš„ä¸œè¥¿æ ¹æœ¬ä¸å€¼å¾—è¢«å¬è§ã€‚", template: "æœ‰ä¸€ç§äººï¼Œæ¯å¤©éƒ½åœ¨_______ï¼Œ\nä½†ä»–ä»¬æœ€å¤§çš„å›°å¢ƒæ˜¯_______ï¼Œ\nå†…å¿ƒæ·±å¤„ï¼Œä»–ä»¬çœŸæ­£å®³æ€•çš„æ˜¯_______ã€‚" },
                { day: 23, title: "ä½ æ˜¯ä»–çš„å‘å¯¼", model: "Graduation-Guide", task: "ã€Step 2ï¼šä½ æ˜¯ä»–çš„å‘å¯¼ã€‘\nä½ ä¸ºä»€ä¹ˆæœ‰èµ„æ ¼å¸®ä»–ï¼Ÿ\nä¸æ˜¯å› ä¸ºä½ å¾ˆå‰å®³ï¼Œæ˜¯å› ä¸ºä½ ç†è§£ä»–çš„å¤„å¢ƒã€‚", example: "èˆŸèˆŸçš„ç¤ºèŒƒï¼š\næˆ‘æ›¾ç»ä¹Ÿæ˜¯è¿™æ ·çš„äººï¼Œæ»¡è‚šå­è¯è¯´ä¸æ¸…æ¥šã€‚åæ¥æˆ‘å‘ç°è¡¨è¾¾æ˜¯å¯ä»¥è®­ç»ƒçš„ï¼Œä¸æ˜¯å¤©èµ‹ï¼Œæ˜¯ç»“æ„ã€‚ç°åœ¨æˆ‘å¯ä»¥å¸®å¥¹ç”¨21å¤©ï¼ŒæŠŠè„‘å­é‡Œçš„ä¸œè¥¿è¯´æ¸…æ¥šã€‚", template: "æˆ‘æ›¾ç»ä¹Ÿæ˜¯è¿™æ ·çš„äººï¼Œ_______ã€‚\nåæ¥æˆ‘å‘ç°_______ã€‚\nç°åœ¨æˆ‘å¯ä»¥å¸®ä»–_______ã€‚" },
                { day: 24, title: "å¸®ä»–çœ‹è§æ–°ç”Ÿæ´»", model: "Graduation-Vision", task: 'ã€Step 3ï¼šå¸®ä»–çœ‹è§æ–°ç”Ÿæ´»ã€‘\nè·Ÿç€ä½ ä¹‹åï¼Œä»–çš„ç”Ÿæ´»ä¼šæœ‰ä»€ä¹ˆå…·ä½“çš„å˜åŒ–ï¼Ÿ\nä¸è¦è¯´"å˜å¾—æ›´å¥½"ï¼Œè¯´ä¸€ä¸ªç”»é¢ã€‚', example: "èˆŸèˆŸçš„ç¤ºèŒƒï¼š\nè·Ÿæˆ‘èµ°å®Œè¿™æ®µè·¯ä¹‹åï¼Œå¥¹å¯ä»¥å¼€å£å°±æœ‰é€»è¾‘ï¼Œä¸å†å®³æ€•è¡¨è¾¾ï¼Œå¼€å§‹è¢«çœŸæ­£éœ€è¦å¥¹çš„äººçœ‹è§ã€‚", template: "è·Ÿæˆ‘èµ°å®Œè¿™æ®µè·¯ä¹‹åï¼Œ\nä»–å¯ä»¥_______ï¼Œ\nä¸å†_______ï¼Œ\nå¼€å§‹_______ã€‚" }
            ]}
        };

        let currentWeek = 1;
        const DB_KEY_PROG = 'zhouzhou_life_prog'; 
        const DB_KEY_INPUT = 'zhouzhou_life_input';
        const DB_KEY_REV = 'zhouzhou_life_rev';

        let completedDays = JSON.parse(LS.get(DB_KEY_PROG)) || [];
        let userInputs = JSON.parse(LS.get(DB_KEY_INPUT)) || {};
        let userRevisions = JSON.parse(LS.get(DB_KEY_REV)) || {};
        
        let activeDayId = null;
        let activeWeekId = 1;

        function init() { renderContent(); updateProgress(); }

        function renderContent() {
            const container = document.getElementById('content-area');
            container.innerHTML = '';
            
            const weekData = syllabus[currentWeek];
            const banner = document.getElementById('week-banner');
            banner.innerHTML = `
                <div class="banner-tag">WEEK 0${currentWeek}</div>
                <div class="banner-title">${weekData.title}</div>
                <div class="banner-desc">${weekData.goal}</div>
            `;
            
            banner.style.animation = 'none';
            banner.offsetHeight; 
            banner.style.animation = 'slideUp 0.4s ease-out';

            let html = `<div class="grid active">`;
            weekData.days.forEach(d => {
                const isDone = completedDays.includes(d.day);
                const dayLabel = currentWeek === 4 ? `0${d.day - 21}` : (d.day < 10 ? `0${d.day}` : d.day);
                const badgePrefix = currentWeek === 4 ? 'STEP' : 'DAY';
                html += `
                    <div class="card ${isDone ? 'completed' : ''}" onclick="openModal(${currentWeek}, ${d.day})">
                        <div class="card-left">
                            <div class="day-badge">${badgePrefix} ${dayLabel}</div>
                            <div class="card-title">${d.task.split('\n')[0]}</div>
                        </div>
                        <div class="check-area" onclick="toggleComplete(event, ${d.day})">
                            <div class="check-icon"></div>
                        </div>
                    </div>`;
            });
            html += `</div>`;

            if (currentWeek === 4) {
                html += `<div class="grad-deadline"><span>â³</span><span>ç»“è¥å 3 å¤©å†…å®Œæˆï¼Œå†™å¥½å‘åˆ°ç¾¤é‡Œ</span></div>`;
                html += `<div class="grad-section">
                    <div class="grad-section-title">ğŸ’¡ ç¤ºèŒƒå‚è€ƒï¼ˆèˆŸèˆŸç‰ˆï¼‰</div>
                    <div class="grad-example-block"><div class="grad-step-label">STEP 01 Â· è‹±é›„</div>æœ‰ä¸€ç§äººï¼Œæ¯å¤©éƒ½æœ‰å¾ˆå¤šæƒ³æ³•ï¼Œä½†ä¸€å¼€å£å°±è¯­æ— ä¼¦æ¬¡ï¼Œå†™å‡ºæ¥è‡ªå·±éƒ½çœ‹ä¸æ‡‚ã€‚ä»–ä»¬æœ€å¤§çš„å›°å¢ƒä¸æ˜¯æ²¡ä¸œè¥¿è¯´ï¼Œè€Œæ˜¯è¯´äº†åˆ«äººä¸æ‡‚ã€å†™äº†æ²¡äººçœ‹ã€‚å†…å¿ƒæ·±å¤„ï¼Œä»–ä»¬çœŸæ­£å®³æ€•çš„æ˜¯ï¼šæˆ‘è¯´çš„ä¸œè¥¿æ ¹æœ¬ä¸å€¼å¾—è¢«å¬è§ã€‚</div>
                    <div class="grad-example-block"><div class="grad-step-label">STEP 02 Â· å‘å¯¼</div>æˆ‘æ›¾ç»ä¹Ÿæ˜¯è¿™æ ·çš„äººï¼Œæ»¡è‚šå­è¯è¯´ä¸æ¸…æ¥šã€‚åæ¥æˆ‘å‘ç°è¡¨è¾¾æ˜¯å¯ä»¥è®­ç»ƒçš„ï¼Œä¸æ˜¯å¤©èµ‹ï¼Œæ˜¯ç»“æ„ã€‚ç°åœ¨æˆ‘å¯ä»¥å¸®å¥¹ç”¨21å¤©ï¼ŒæŠŠè„‘å­é‡Œçš„ä¸œè¥¿è¯´æ¸…æ¥šã€‚</div>
                    <div class="grad-example-block"><div class="grad-step-label">STEP 03 Â· æ–°ç”Ÿæ´»</div>è·Ÿæˆ‘èµ°å®Œè¿™æ®µè·¯ä¹‹åï¼Œå¥¹å¯ä»¥å¼€å£å°±æœ‰é€»è¾‘ï¼Œä¸å†å®³æ€•è¡¨è¾¾ï¼Œå¼€å§‹è¢«çœŸæ­£éœ€è¦å¥¹çš„äººçœ‹è§ã€‚</div>
                </div>`;
                html += `<div class="grad-standard">
                    <div class="grad-standard-title">âœ… å®Œæˆæ ‡å‡†</div>
                    <div class="grad-standard-item"><div class="grad-standard-dot"></div><div>ä¸€ä¸ªå®Œå…¨ä¸è®¤è¯†ä½ çš„äººï¼Œçœ‹å®ŒçŸ¥é“ä½ åœ¨å¸®è°</div></div>
                    <div class="grad-standard-item"><div class="grad-standard-dot"></div><div>çŸ¥é“ä½ èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜</div></div>
                    <div class="grad-standard-item"><div class="grad-standard-dot"></div><div>è§‰å¾—"è¿™è¯´çš„å°±æ˜¯æˆ‘"æˆ–è€…"æˆ‘è®¤è¯†è¿™æ ·çš„äºº"</div></div>
                </div>`;
                html += `<button class="btn-guide" onclick="generateGuideResult()">âœ¨ åˆå¹¶ç”Ÿæˆæˆ‘çš„å‘å¯¼å®£è¨€</button>`;
                html += `<div class="guide-result" id="guide-result"><div class="guide-result-label">ğŸ“„ æˆ‘çš„å‘å¯¼å®£è¨€</div><div class="guide-result-text" id="guide-result-text"></div></div>`;
                html += `<button class="btn-guide-copy" id="btn-guide-copy" onclick="copyGuideResult()">ğŸ“‹ å¤åˆ¶å…¨æ–‡ï¼Œå‘åˆ°ç¾¤é‡Œ</button>`;
                html += `<button class="btn-report" onclick="generateGuideImage()" style="margin-top:12px;">ğŸ“¸ ç”Ÿæˆå‘å¯¼å®£è¨€æµ·æŠ¥</button>`;
            }

            container.innerHTML = html;
        }

        function switchWeek(weekNum) {
            currentWeek = weekNum;
            document.querySelectorAll('.nav-item').forEach((btn, idx) => {
                btn.className = (idx + 1 === weekNum) ? 'nav-item active' : 'nav-item';
            });
            renderContent();
        }

        function toggleComplete(event, dayId) {
            event.stopPropagation(); 
            const idx = completedDays.indexOf(dayId);
            if (idx > -1) completedDays.splice(idx, 1);
            else completedDays.push(dayId);
            LS.set(DB_KEY_PROG, JSON.stringify(completedDays));
            updateProgress();
            renderContent(); 
        }

        function updateProgress() {
            const totalDays = Object.values(syllabus).reduce((sum, w) => sum + w.days.length, 0);
            const pct = Math.round((completedDays.length / totalDays) * 100);
            document.getElementById('progress-bar').style.width = pct + '%';
            document.getElementById('progress-text').innerText = pct + '%';
        }

        function openModal(week, dayId) {
            const data = syllabus[week].days.find(d => d.day === dayId);
            if (!data) return;
            activeDayId = dayId;
            activeWeekId = week;
            
            document.getElementById('m-title').innerText = `Day ${dayId} | ${data.title}`;
            document.getElementById('m-task').innerText = data.task;
            document.getElementById('m-example').innerText = data.example;
            
            const inputArea = document.getElementById('m-input');
            const revArea = document.getElementById('m-revision');
            
            inputArea.value = userInputs[dayId] || data.template;
            revArea.value = userRevisions[dayId] || "";

            document.getElementById('ai-box').style.display = 'none';
            document.getElementById('modal').classList.add('open');
        }

        document.getElementById('m-input').addEventListener('input', function(e) {
            if (!activeDayId) return;
            userInputs[activeDayId] = e.target.value;
            LS.set(DB_KEY_INPUT, JSON.stringify(userInputs));
            document.getElementById('save-msg').innerText = "åˆç¨¿å·²ä¿å­˜";
        });

        document.getElementById('m-revision').addEventListener('input', function(e) {
            if (!activeDayId) return;
            userRevisions[activeDayId] = e.target.value;
            LS.set(DB_KEY_REV, JSON.stringify(userRevisions));
            document.getElementById('save-msg').innerText = "æˆå“å·²ä¿å­˜";
        });

        function generateAiPrompt() {
            const inputVal = document.getElementById('m-input').value;
            const dayData = syllabus[activeWeekId].days.find(d => d.day === activeDayId);
            const templateText = dayData.template.trim();
            const currentText = inputVal ? inputVal.trim() : "";

            if (!currentText || currentText.length < 5 || currentText === templateText) {
                alert("âš ï¸ è¯·å…ˆå†™ç‚¹ä¸œè¥¿ï¼ˆæ”¯æŒè¯­éŸ³è¾“å…¥ï¼‰ï¼\nä¸èƒ½äº¤ç™½å·å“¦ã€‚");
                return;
            }

            let prompt = '';
            const taskDesc = dayData.task.replace(/\n/g, " ");

            if (activeWeekId === 1) {
                // Week 1: SCQA è§‚ç‚¹è®­ç»ƒ
                prompt = `ä½ æ˜¯ä¸€ä½ç»“æ„åŒ–è¡¨è¾¾æ•™ç»ƒã€‚æˆ‘æ­£åœ¨ç»ƒä¹ ç”¨SCQAæ¡†æ¶è¯´æ¸…æ¥šä¸€ä»¶äº‹ã€‚

ã€ä»Šæ—¥åœºæ™¯ã€‘ï¼š${dayData.title}
ã€ä»»åŠ¡è¦æ±‚ã€‘ï¼š${taskDesc}

ã€æˆ‘çš„åˆç¨¿ã€‘ï¼š
${inputVal}

è¯·å¸®æˆ‘åšä¸‰ä»¶äº‹ï¼ˆç›´æ¥ä¸Šå¹²è´§ï¼Œä¸è¦è®²é“ç†ï¼‰ï¼š

1. ğŸ” è¦ç´ æ‹†è§£ï¼š
   æˆ‘çš„è¡¨è¾¾é‡Œï¼ŒS(æƒ…å¢ƒ)ã€C(å†²çª)ã€A(ç­”æ¡ˆ) åˆ†åˆ«æ˜¯å“ªå¥è¯ï¼Ÿ
   å¦‚æœæœ‰ç¼ºå¤±æˆ–è¡¨è¾¾ä¸æ¸…çš„ï¼Œç›´æ¥æŒ‡å‡ºã€‚

2. ğŸ¯ æœ€å¼±ç¯èŠ‚ï¼š
   å“ªä¸ªè¦ç´ æœ€è–„å¼±ï¼Ÿç»™æˆ‘ä¸€ä¸ªå…·ä½“çš„ä¿®æ”¹æ–¹å‘ï¼ˆä¸è¦å¸®æˆ‘é‡å†™æ•´æ®µï¼Œåªç‚¹å‡ºæ–¹å‘ï¼‰ã€‚

3. â“ è¿½é—®ï¼š
   é—®æˆ‘ä¸€ä¸ªé—®é¢˜ï¼Œè®©æˆ‘æŠŠæœ€å¼±çš„éƒ¨åˆ†æƒ³å¾—æ›´æ¸…æ¥šï¼Œæˆ‘è‡ªå·±å†æ”¹ä¸€ç‰ˆã€‚

è¯·ç›´æ¥è¾“å‡ºç»“æœã€‚`;
            } else if (activeWeekId === 2) {
                // Week 2: ç»“æ„é€»è¾‘è®­ç»ƒ
                prompt = `ä½ æ˜¯ä¸€ä½ç»“æ„åŒ–è¡¨è¾¾æ•™ç»ƒã€‚æˆ‘æ­£åœ¨ç»ƒä¹ è®©è¡¨è¾¾æ›´æœ‰é€»è¾‘ã€æ›´æœ‰æ¡ç†ã€‚

ã€ä»Šæ—¥åœºæ™¯ã€‘ï¼š${dayData.title}
ã€ä»»åŠ¡è¦æ±‚ã€‘ï¼š${taskDesc}

ã€æˆ‘çš„åˆç¨¿ã€‘ï¼š
${inputVal}

è¯·å¸®æˆ‘åšä¸‰ä»¶äº‹ï¼ˆç›´æ¥ä¸Šå¹²è´§ï¼Œä¸è¦è®²é“ç†ï¼‰ï¼š

1. ğŸ” ç»“æ„æ‰«æï¼š
   æˆ‘ç”¨äº†ä»€ä¹ˆç»“æ„ï¼ˆæ€»åˆ†æ€»/æ­£åè®ºè¯/æ—¶é—´é¡ºåº/å¹¶åˆ—åˆ†ç±»ï¼‰ï¼Ÿ
   ç»“æ„å®Œæ•´å—ï¼Ÿæœ‰æ²¡æœ‰é€»è¾‘æ–­è£‚æˆ–è·‘åçš„åœ°æ–¹ï¼Ÿ

2. ğŸ¯ ç ä¸€åˆ€ï¼š
   æŒ‡å‡ºä¸€å¥"è¯´äº†ç­‰äºæ²¡è¯´"çš„åºŸè¯ï¼Œæˆ–è€…é€»è¾‘æœ€å¼±çš„åœ°æ–¹ã€‚å‘Šè¯‰æˆ‘æ€ä¹ˆè°ƒæ•´æ–¹å‘ï¼ˆä¸è¦å¸®æˆ‘é‡å†™æ•´æ®µï¼‰ã€‚

3. â“ è¯»è€…è§†è§’ï¼š
   å¦‚æœä¸€ä¸ªå®Œå…¨ä¸äº†è§£èƒŒæ™¯çš„äººå¬åˆ°è¿™æ®µè¯ï¼Œä»–æœ€å¯èƒ½é—®çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ

è¯·ç›´æ¥è¾“å‡ºç»“æœã€‚`;
            } else if (activeWeekId === 3) {
                // Week 3: æ´å¯Ÿé«˜çº§è®­ç»ƒ
                prompt = `ä½ æ˜¯ä¸€ä½è¡¨è¾¾æ•™ç»ƒï¼Œæ“…é•¿å¸®äººæç‚¼æ´å¯Ÿå’Œé‡‘å¥ã€‚æˆ‘æ­£åœ¨ç»ƒä¹ è®©è¡¨è¾¾æ›´æœ‰ç”»é¢æ„Ÿå’Œæ·±åº¦ã€‚

ã€ä»Šæ—¥åœºæ™¯ã€‘ï¼š${dayData.title}
ã€ä»»åŠ¡è¦æ±‚ã€‘ï¼š${taskDesc}

ã€æˆ‘çš„åˆç¨¿ã€‘ï¼š
${inputVal}

è¯·å¸®æˆ‘åšä¸‰ä»¶äº‹ï¼ˆç›´æ¥ä¸Šå¹²è´§ï¼Œä¸è¦è®²é“ç†ï¼‰ï¼š

1. ğŸ” ç”»é¢æ„Ÿæ£€æµ‹ï¼š
   è¯»å®Œæˆ‘å†™çš„ï¼Œè„‘å­é‡Œèƒ½"çœ‹åˆ°"ä¸€ä¸ªå…·ä½“åœºæ™¯å—ï¼Ÿ
   å¦‚æœå¤ªæŠ½è±¡ï¼ŒæŒ‡å‡ºå“ªé‡Œéœ€è¦æ›´å…·ä½“çš„ç»†èŠ‚ã€‚

2. ğŸ¯ æ·±åº¦æµ‹è¯•ï¼š
   æˆ‘è¯´çš„æ˜¯"æ­£ç¡®çš„åºŸè¯"ï¼ˆè°éƒ½çŸ¥é“çš„é“ç†ï¼‰ï¼Œè¿˜æ˜¯æœ‰çœŸå®æ´å¯Ÿï¼Ÿ
   å¦‚æœä¸å¤Ÿæ·±ï¼Œå‘Šè¯‰æˆ‘å¯ä»¥å¾€å“ªä¸ªæ–¹å‘å†æŒ–ä¸€å±‚ï¼ˆä¸è¦å¸®æˆ‘é‡å†™æ•´æ®µï¼‰ã€‚

3. â“ åè½¬æŒ‘æˆ˜ï¼š
   ç»™æˆ‘ä¸€ä¸ªåé¢è§†è§’æˆ–åä¾‹ï¼Œè®©æˆ‘é‡æ–°å®¡è§†è‡ªå·±çš„è§‚ç‚¹ï¼Œçœ‹èƒ½ä¸èƒ½è¯´å¾—æ›´æ‰å®ã€‚

è¯·ç›´æ¥è¾“å‡ºç»“æœã€‚`;
            } else {
                // Week 4: ç»“è¥é¡¹ç›®
                prompt = `ä½ æ˜¯ä¸€ä½å“ç‰Œå®šä½æ•™ç»ƒã€‚æˆ‘æ­£åœ¨å®Œæˆç»“è¥é¡¹ç›®â€”â€”å†™å‡º"æˆ‘èƒ½å¸®è°è§£å†³ä»€ä¹ˆé—®é¢˜"ã€‚

ã€å½“å‰æ­¥éª¤ã€‘ï¼š${dayData.title}
ã€ä»»åŠ¡è¦æ±‚ã€‘ï¼š${taskDesc}

ã€æˆ‘å†™çš„å†…å®¹ã€‘ï¼š
${inputVal}

è¯·ä½ æ¨¡æ‹Ÿä¸€ä¸ªå®Œå…¨ä¸è®¤è¯†æˆ‘çš„é™Œç”Ÿäººï¼Œè¯»å®Œååšä¸‰ä»¶äº‹ï¼š

1. ğŸ‘¤ é™Œç”Ÿäººè§†è§’ï¼š
   - æˆ‘çœ‹å®ŒçŸ¥é“ä½ åœ¨å¸®ä»€ä¹ˆæ ·çš„äººå—ï¼Ÿï¼ˆå…·ä½“è¿˜æ˜¯æ¨¡ç³Šï¼Ÿï¼‰
   - èƒ½æ„Ÿå—åˆ°ä½ çœŸçš„ç†è§£è¿™ç±»äººå—ï¼Ÿï¼ˆçœŸå®è¿˜æ˜¯å¥—è¯ï¼Ÿï¼‰
   - æœ‰æ²¡æœ‰è§‰å¾—"è¿™è¯´çš„å¥½åƒå°±æ˜¯æˆ‘"ï¼Ÿ

2. ğŸ¯ æ”¹ä¸€ä¸ªåœ°æ–¹ï¼š
   å¦‚æœåªèƒ½æ”¹ä¸€å¤„ï¼Œä½ å»ºè®®æˆ‘æ”¹å“ªé‡Œï¼Ÿç»™æ–¹å‘å°±è¡Œï¼Œä¸ç”¨å¸®æˆ‘é‡å†™ã€‚

3. â“ å¸®æˆ‘æŒ–æ›´æ·±ï¼š
   é—®æˆ‘ä¸€ä¸ªé—®é¢˜ï¼Œè®©æˆ‘æŠŠè¿™ä¸ªäººçš„ç”»åƒæƒ³å¾—æ›´å…·ä½“ã€æ›´çœŸå®ã€‚

è¯·ç›´æ¥è¾“å‡ºç»“æœã€‚`;
            }

            document.getElementById('ai-prompt-text').innerText = prompt;
            document.getElementById('ai-box').style.display = 'block';
            setTimeout(() => {
                const modalBody = document.querySelector('.modal-body');
                modalBody.scrollTo({ top: modalBody.scrollHeight, behavior: 'smooth' });
            }, 100);
        }

        function forceCopy(btnElement) {
            const text = document.getElementById('ai-prompt-text').innerText;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text)
                    .then(() => showSuccess(btnElement))
                    .catch(() => fallbackCopy(text, btnElement));
            } else { fallbackCopy(text, btnElement); }
        }

        function jumpToDoubao(btnElement) {
            const text = document.getElementById('ai-prompt-text').innerText;
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed'; textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            try { document.execCommand('copy'); showSuccess(btnElement); } catch (e) {}
            document.body.removeChild(textarea);
            window.open("https://www.doubao.com/chat/", "_blank");
        }

        function fallbackCopy(text, btnElement) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; textArea.style.left = "-9999px"; textArea.style.top = "0"; textArea.setAttribute("readonly", "");
            document.body.appendChild(textArea);
            if (navigator.userAgent.match(/ipad|iphone/i)) {
                const range = document.createRange(); range.selectNodeContents(textArea);
                const selection = window.getSelection(); selection.removeAllRanges(); selection.addRange(range);
                textArea.setSelectionRange(0, 999999);
            } else { textArea.select(); }
            try { document.execCommand('copy'); showSuccess(btnElement); } catch (e) { alert("å¤åˆ¶å—é™ï¼Œè¯·é•¿æŒ‰æ‰‹åŠ¨å¤åˆ¶"); }
            document.body.removeChild(textArea);
        }

        function showSuccess(btn) {
            const originalText = btn.innerHTML;
            btn.innerHTML = "âœ… å·²å¤åˆ¶";
            btn.classList.add("success");
            setTimeout(() => { btn.innerHTML = originalText; btn.classList.remove("success"); }, 2000);
        }

        function generateVisualReport() {
            const revVal = document.getElementById('m-revision').value.trim();
            const inputVal = document.getElementById('m-input').value.trim();
            
            if (revVal.length < 2) {
                if(!confirm("âš ï¸ å»ºè®®æŠŠ AI æ”¹å¥½çš„ç‰ˆæœ¬å¡«åœ¨ã€é€»è¾‘æ¸…æ™°ç‰ˆã€‘é‡Œå†ç”Ÿæˆæˆ˜æŠ¥ï¼Œæ•ˆæœæ›´å¥½å“¦ã€‚\n\næ˜¯å¦åšæŒåªç”Ÿæˆåˆç¨¿ï¼Ÿ")) return;
            }

            const canvas = document.getElementById('canvas-buffer');
            const ctx = canvas.getContext('2d');
            const W = 1080; const H = 1440;
            
            let taskTitle = "";
            for(let p=1; p<=4; p++) { 
                const d = syllabus[p].days.find(i => i.day === activeDayId); 
                if(d) { taskTitle = d.title; }
            }

            const grd = ctx.createLinearGradient(0, 0, 0, H);
            grd.addColorStop(0, "#0f172a"); grd.addColorStop(1, "#020617");
            ctx.fillStyle = grd; ctx.fillRect(0, 0, W, H);
            ctx.strokeStyle = "#1e293b"; ctx.lineWidth = 2;
            for(let i=0; i<H; i+=60) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(W,i); ctx.stroke(); }

            ctx.fillStyle = "#3b82f6"; ctx.font = "bold 40px 'JetBrains Mono'"; ctx.fillText("LOGIC LAB", 60, 100);
            ctx.fillStyle = "#fff"; ctx.font = "900 200px 'JetBrains Mono'"; ctx.fillText(activeDayId < 10 ? `0${activeDayId}` : `${activeDayId}`, 50, 320);
            ctx.fillStyle = "#94a3b8"; ctx.font = "bold 50px 'Noto Sans SC'"; ctx.fillText(`ç”Ÿæ´»å®æˆ˜ | ${taskTitle}`, 60, 420);

            const boxY = 480;
            ctx.fillStyle = "#0f172a"; ctx.fillRect(60, boxY, W-120, H-600);
            ctx.strokeStyle = "#334155"; ctx.strokeRect(60, boxY, W-120, H-600);

            let contentToDraw = "";
            let label = "";
            let color = "";

            if (revVal.length > 5) {
                label = "ğŸ† é€»è¾‘æ¸…æ™°ç‰ˆ";
                contentToDraw = revVal;
                color = "#fcd34d"; 
            } else {
                label = "ğŸ“ åŸå§‹è®°å½•";
                contentToDraw = inputVal;
                color = "#e2e8f0"; 
            }

            ctx.fillStyle = color; ctx.font = "bold 36px 'Noto Sans SC'"; ctx.fillText(label, 100, boxY + 80);
            ctx.fillStyle = "#ffffff"; ctx.font = "36px 'Noto Sans SC'"; 
            wrapText(ctx, contentToDraw, 100, boxY + 160, W-200, 60);

            ctx.fillStyle = "#3b82f6"; ctx.font = "30px 'Noto Sans SC'"; ctx.fillText("#ç»“æ„åŒ–è¡¨è¾¾ç”Ÿæ´»å®æˆ˜", 60, H-60);
            
            document.getElementById('report-img').src = canvas.toDataURL("image/png");
            document.getElementById('report-overlay').classList.add('show');
        }

        function closeReport() { document.getElementById('report-overlay').classList.remove('show'); }

        function downloadReportImg() {
            var img = document.getElementById('report-img');
            var link = document.createElement('a');
            link.download = 'æ€ç»´è®­ç»ƒè¥-' + new Date().toISOString().slice(0,10) + '.png';
            link.href = img.src;
            // iOS Safari ä¸æ”¯æŒ download å±æ€§ï¼Œç”¨ blob URL å°è¯•
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                // iOS: å°è¯•æ‰“å¼€æ–°çª—å£è®©ç”¨æˆ·æ‰‹åŠ¨ä¿å­˜
                var w = window.open('');
                if (w) { w.document.write('<img src="' + img.src + '" style="width:100%">'); w.document.title = 'é•¿æŒ‰å›¾ç‰‡ä¿å­˜'; }
                else { alert('è¯·é•¿æŒ‰ä¸Šæ–¹å›¾ç‰‡ï¼Œé€‰æ‹©"ä¿å­˜å›¾ç‰‡"'); }
                return;
            }
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function wrapText(context, text, x, y, maxWidth, lineHeight) {
            const paragraphs = text.split('\n'); let currentY = y;
            paragraphs.forEach(paragraph => {
                let line = ''; const words = paragraph.split('');
                for(let n = 0; n < words.length; n++) {
                    const testLine = line + words[n];
                    if (context.measureText(testLine).width > maxWidth && n > 0) { context.fillText(line, x, currentY); line = words[n]; currentY += lineHeight; } else { line = testLine; }
                }
                context.fillText(line, x, currentY); currentY += lineHeight * 1.5;
            });
        }

        function copyDataString(btn) {
            const data = { prog: completedDays, data: userInputs, rev: userRevisions };
            const str = "LIFE_BACKUP::" + btoa(encodeURIComponent(JSON.stringify(data)));
            fallbackCopy(str, btn);
        }

        function pasteDataString() {
            const code = prompt("è¯·ç²˜è´´æ‚¨çš„å¤‡ä»½å£ä»¤ (ä»¥ LIFE_BACKUP:: å¼€å¤´)");
            if (!code) return;
            try {
                if (code.startsWith("LIFE_BACKUP::")) {
                    const cleanCode = code.replace("LIFE_BACKUP::", "");
                    const jsonString = decodeURIComponent(atob(cleanCode));
                    const data = JSON.parse(jsonString);
                    if (confirm("ç¡®å®šè¦æ¢å¤æ•°æ®å—ï¼Ÿå½“å‰è¿›åº¦å°†è¢«è¦†ç›–ã€‚")) {
                        completedDays = data.prog || [];
                        userInputs = data.data || {};
                        userRevisions = data.rev || {};
                        LS.set(DB_KEY_PROG, JSON.stringify(completedDays));
                        LS.set(DB_KEY_INPUT, JSON.stringify(userInputs));
                        LS.set(DB_KEY_REV, JSON.stringify(userRevisions));
                        init();
                        alert("ğŸ‰ æ•°æ®å·²æˆåŠŸæ¢å¤ï¼");
                    }
                } else { alert("âŒ å£ä»¤æ ¼å¼é”™è¯¯"); }
            } catch (e) { alert("âŒ æ•°æ®æŸå"); }
        }

        function resetData() {
            if(confirm("âš ï¸ è­¦å‘Šï¼šç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è¿›åº¦é‡æ–°å¼€å§‹å—ï¼Ÿ\n\næ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼å¦‚æœéœ€è¦ä¿ç•™æ•°æ®ï¼Œè¯·å…ˆç‚¹å‡»ã€å¤‡ä»½è¿›åº¦ã€‘ã€‚")) {
                LS.remove(DB_KEY_PROG);
                LS.remove(DB_KEY_INPUT);
                LS.remove(DB_KEY_REV);
                location.reload();
            }
        }

        function closeModal(event) {
            if (!event || event.target.id === 'modal' || event.target.classList.contains('close-btn')) {
                document.getElementById('modal').classList.remove('open');
                activeDayId = null;
            }
        }

        function generateGuideResult() {
            var t1 = (userInputs[22] || '').trim();
            var t2 = (userInputs[23] || '').trim();
            var t3 = (userInputs[24] || '').trim();
            if (t1.length < 10 || t2.length < 10 || t3.length < 10) {
                alert('âš ï¸ æ¯ä¸ªæ­¥éª¤è‡³å°‘å†™10ä¸ªå­—å“¦ï¼å…ˆæŠŠä¸‰æ­¥éƒ½å†™å®Œå†æ¥ç”Ÿæˆå‘å¯¼å®£è¨€ã€‚');
                return;
            }
            var r1 = (userRevisions[22] || '').trim();
            var r2 = (userRevisions[23] || '').trim();
            var r3 = (userRevisions[24] || '').trim();
            var final1 = r1.length > 10 ? r1 : t1;
            var final2 = r2.length > 10 ? r2 : t2;
            var final3 = r3.length > 10 ? r3 : t3;
            var full = final1 + '\n\n' + final2 + '\n\n' + final3;
            document.getElementById('guide-result-text').innerText = full;
            document.getElementById('guide-result').classList.add('show');
            document.getElementById('btn-guide-copy').style.display = 'flex';
            setTimeout(function() {
                document.getElementById('guide-result').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function generateGuideImage() {
            var t1 = (userInputs[22] || '').trim();
            var t2 = (userInputs[23] || '').trim();
            var t3 = (userInputs[24] || '').trim();
            if (t1.length < 10 || t2.length < 10 || t3.length < 10) {
                alert('âš ï¸ å…ˆå®Œæˆä¸‰ä¸ªæ­¥éª¤å¹¶ç”Ÿæˆå‘å¯¼å®£è¨€ï¼Œå†æ¥ç”Ÿæˆæµ·æŠ¥ã€‚');
                return;
            }
            var r1 = (userRevisions[22] || '').trim();
            var r2 = (userRevisions[23] || '').trim();
            var r3 = (userRevisions[24] || '').trim();
            var hasV2 = (r1.length > 10 || r2.length > 10 || r3.length > 10);
            // å¦‚æœæ²¡æœ‰è¿›åŒ–ç‰ˆï¼Œæç¤ºç”¨æˆ·
            if (!hasV2) {
                if (!confirm("âš ï¸ å»ºè®®æŠŠ AI æ”¹å¥½çš„ç‰ˆæœ¬å¡«åœ¨ã€è¿›åŒ–ç‰ˆã€‘é‡Œå†ç”Ÿæˆæµ·æŠ¥ï¼Œå¯¹æ¯”æ•ˆæœæ›´å¥½ã€‚\n\næ˜¯å¦åšæŒåªç”Ÿæˆåˆç¨¿ç‰ˆï¼Ÿ")) return;
            }

            var FONT = "'PingFang SC','Noto Sans SC','Microsoft YaHei',sans-serif";
            var canvas = document.getElementById('canvas-buffer');
            var W = 1080;
            var maxTextW = W - 220;
            var fontSize = 30;
            var lineH = 48;
            var subLabelH = 50;
            var secGap = 35;

            var secs = [
                { num: "01", label: "æˆ‘çš„è‹±é›„", v1: t1, v2: r1.length > 10 ? r1 : '', color: "#60a5fa", colorDim: "rgba(96,165,250,0.06)" },
                { num: "02", label: "æˆ‘æ˜¯å‘å¯¼", v1: t2, v2: r2.length > 10 ? r2 : '', color: "#a78bfa", colorDim: "rgba(167,139,250,0.06)" },
                { num: "03", label: "æ–°ç”Ÿæ´»", v1: t3, v2: r3.length > 10 ? r3 : '', color: "#fbbf24", colorDim: "rgba(251,191,36,0.06)" }
            ];

            // === æµ‹é‡æ–‡å­—é«˜åº¦çš„å·¥å…·å‡½æ•° ===
            function measureTextH(mCtx, text) {
                var textH = 0;
                var paragraphs = text.split('\n');
                paragraphs.forEach(function(para) {
                    var line = ''; var chars = para.split('');
                    for (var n = 0; n < chars.length; n++) {
                        var test = line + chars[n];
                        if (mCtx.measureText(test).width > maxTextW && n > 0) {
                            line = chars[n]; textH += lineH;
                        } else { line = test; }
                    }
                    textH += lineH * 1.3;
                });
                return textH;
            }

            // === Pass 1: æµ‹é‡æ¯æ®µæ€»é«˜åº¦ ===
            canvas.width = W; canvas.height = 100;
            var mCtx = canvas.getContext('2d');
            mCtx.font = fontSize + "px " + FONT;

            var secHeights = [];
            secs.forEach(function(sec) {
                var stepLabelH = 70;
                var v1H = subLabelH + measureTextH(mCtx, sec.v1) + 15;
                var v2H = sec.v2 ? (subLabelH + measureTextH(mCtx, sec.v2) + 15) : 0;
                var dividerH = sec.v2 ? 30 : 0;
                var total = stepLabelH + v1H + dividerH + v2H + 40;
                secHeights.push(Math.max(total, 200));
            });

            // === è®¡ç®—ç”»å¸ƒé«˜åº¦ ===
            var headerH = 280;
            var footerH = 130;
            var contentH = 0;
            secHeights.forEach(function(h) { contentH += h; });
            contentH += secGap * (secs.length - 1);
            var H = headerH + contentH + footerH;
            H = Math.max(H, 1200);

            // === Pass 2: ç»˜åˆ¶ ===
            canvas.width = W; canvas.height = H;
            var ctx = canvas.getContext('2d');

            // èƒŒæ™¯
            var grd = ctx.createLinearGradient(0, 0, 0, H);
            grd.addColorStop(0, "#0f172a"); grd.addColorStop(0.5, "#1a1035"); grd.addColorStop(1, "#020617");
            ctx.fillStyle = grd; ctx.fillRect(0, 0, W, H);
            ctx.strokeStyle = "rgba(148,163,184,0.06)"; ctx.lineWidth = 1;
            for (var i = 0; i < H; i += 60) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(W,i); ctx.stroke(); }

            // æ ‡é¢˜
            ctx.fillStyle = "#a78bfa"; ctx.font = "bold 36px " + FONT;
            ctx.fillText("GUIDE  DECLARATION", 80, 80);
            ctx.fillStyle = "#ffffff"; ctx.font = "900 72px " + FONT;
            ctx.fillText("æˆ‘çš„å‘å¯¼å®£è¨€", 80, 180);
            var barGrd = ctx.createLinearGradient(80, 0, 400, 0);
            barGrd.addColorStop(0, "#3b82f6"); barGrd.addColorStop(1, "#8b5cf6");
            ctx.fillStyle = barGrd; ctx.fillRect(80, 215, 280, 6);

            // === ç»˜åˆ¶æ–‡å­—å—çš„å·¥å…·å‡½æ•° ===
            function drawTextBlock(ctx, text, x, startY, color) {
                ctx.fillStyle = color;
                ctx.font = fontSize + "px " + FONT;
                var textY = startY;
                var paragraphs = text.split('\n');
                paragraphs.forEach(function(para) {
                    var line = ''; var chars = para.split('');
                    for (var n = 0; n < chars.length; n++) {
                        var test = line + chars[n];
                        if (ctx.measureText(test).width > maxTextW && n > 0) {
                            ctx.fillText(line, x, textY);
                            line = chars[n]; textY += lineH;
                        } else { line = test; }
                    }
                    ctx.fillText(line, x, textY);
                    textY += lineH * 1.3;
                });
                return textY;
            }

            // === ä¸‰æ®µå†…å®¹ ===
            var currentY = headerH;
            var padLeft = 100;

            secs.forEach(function(sec, idx) {
                var thisH = secHeights[idx];

                // é¢æ¿èƒŒæ™¯
                ctx.fillStyle = sec.colorDim;
                roundRect(ctx, 60, currentY, W - 120, thisH, 16);
                ctx.fill();

                // å·¦ä¾§è‰²æ¡
                ctx.fillStyle = sec.color;
                roundRect(ctx, 60, currentY, 6, thisH, 3);
                ctx.fill();

                // å¤§ç¼–å·æ°´å°
                ctx.globalAlpha = 0.04;
                ctx.fillStyle = sec.color;
                ctx.font = "900 200px " + FONT;
                ctx.fillText(sec.num, W - 320, currentY + 180);
                ctx.globalAlpha = 1;

                // STEP æ ‡ç­¾
                ctx.fillStyle = sec.color;
                ctx.font = "bold 34px " + FONT;
                ctx.fillText("STEP " + sec.num + " Â· " + sec.label, padLeft, currentY + 48);

                var textY = currentY + 80;

                // ğŸ“ åˆç¨¿æ ‡ç­¾
                ctx.fillStyle = "#94a3b8";
                ctx.font = "bold 26px " + FONT;
                ctx.fillText("ğŸ“ åˆç¨¿", padLeft, textY + 30);
                textY += subLabelH + 10;

                // åˆç¨¿æ­£æ–‡ï¼ˆç°è‰²è°ƒï¼‰
                textY = drawTextBlock(ctx, sec.v1, padLeft, textY, "#8896a8");

                // å¦‚æœæœ‰è¿›åŒ–ç‰ˆ
                if (sec.v2) {
                    textY += 5;
                    // åˆ†éš”çº¿
                    ctx.strokeStyle = "rgba(148,163,184,0.15)";
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(padLeft, textY);
                    ctx.lineTo(W - padLeft, textY);
                    ctx.stroke();
                    textY += 25;

                    // ğŸ† è¿›åŒ–ç‰ˆæ ‡ç­¾
                    ctx.fillStyle = "#fcd34d";
                    ctx.font = "bold 26px " + FONT;
                    ctx.fillText("ğŸ† è¿›åŒ–ç‰ˆ", padLeft, textY);
                    textY += subLabelH;

                    // è¿›åŒ–ç‰ˆæ­£æ–‡ï¼ˆé«˜äº®ç™½è‰²ï¼‰
                    drawTextBlock(ctx, sec.v2, padLeft, textY, "#f1f5f9");
                }

                currentY += thisH + secGap;
            });

            // åº•éƒ¨
            ctx.fillStyle = "rgba(148,163,184,0.3)";
            ctx.fillRect(80, H - 90, W - 160, 1);
            ctx.fillStyle = "#64748b"; ctx.font = "28px " + FONT;
            ctx.fillText("#æ€ç»´è¿›åŒ–è®­ç»ƒè¥ Â· ç»“è¥é¡¹ç›®", 80, H - 45);
            ctx.fillStyle = "#475569"; ctx.font = "24px " + FONT;
            var rightText = "çŸ¥è¯†åœŸåŒª Â· CANOE";
            ctx.fillText(rightText, W - 80 - ctx.measureText(rightText).width, H - 45);

            document.getElementById('report-img').src = canvas.toDataURL("image/png");
            document.getElementById('report-overlay').classList.add('show');
            canvas.width = 1080; canvas.height = 1440;
        }

        function roundRect(ctx, x, y, w, h, r) {
            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.lineTo(x + w - r, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + r);
            ctx.lineTo(x + w, y + h - r);
            ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
            ctx.lineTo(x + r, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - r);
            ctx.lineTo(x, y + r);
            ctx.quadraticCurveTo(x, y, x + r, y);
            ctx.closePath();
        }

        function copyGuideResult() {
            var text = document.getElementById('guide-result-text').innerText;
            var btn = document.getElementById('btn-guide-copy');
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(function() { showSuccess(btn); }).catch(function() { fallbackCopy(text, btn); });
            } else { fallbackCopy(text, btn); }
        }

        // ===== ğŸ“… å¯¼å‡º ICS æ—¥å† =====
        function exportCalendar(btn) {
            // è®©ç”¨æˆ·é€‰æ‹©ä»å“ªå¤©å¼€å§‹
            const startInput = prompt("ä»å“ªå¤©å¼€å§‹è®­ç»ƒï¼Ÿ\nè¯·è¾“å…¥å¼€å§‹æ—¥æœŸï¼ˆæ ¼å¼ï¼š2026-02-20ï¼‰", getTodayStr());
            if (!startInput) return;
            const startDate = new Date(startInput);
            if (isNaN(startDate.getTime())) {
                alert('æ—¥æœŸæ ¼å¼ä¸å¯¹ï¼Œè¯·è¾“å…¥å¦‚ 2026-02-20 çš„æ ¼å¼');
                return;
            }

            const lines = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//èˆŸèˆŸæ€ç»´è®­ç»ƒè¥//CN',
                'CALSCALE:GREGORIAN',
                'METHOD:PUBLISH',
                'X-WR-CALNAME:æ€ç»´è®­ç»ƒè¥ 21å¤©æ‰“å¡',
                'X-WR-TIMEZONE:Asia/Shanghai',
            ];

            // æ‰€æœ‰ 21 å¤©çš„ä»»åŠ¡
            const allDays = [];
            Object.keys(syllabus).forEach(w => { syllabus[w].days.forEach(d => allDays.push(d)); });

            allDays.forEach((d, idx) => {
                const eventDate = new Date(startDate);
                eventDate.setDate(startDate.getDate() + idx);
                const dateStr = formatIcsDate(eventDate);
                const weekNum = idx < 7 ? 1 : idx < 14 ? 2 : 3;
                const uid = 'zhouzhou-day' + d.day + '@logic2026';
                const title = 'Day ' + (d.day < 10 ? '0' + d.day : d.day) + ' Â· ' + d.title;
                const desc = d.task.replace(/\n/g, '\\n').replace(/,/g, '\\,');

                lines.push('BEGIN:VEVENT');
                lines.push('UID:' + uid);
                lines.push('DTSTART;VALUE=DATE:' + dateStr);
                lines.push('DTEND;VALUE=DATE:' + dateStr);
                lines.push('SUMMARY:ğŸ§  ' + title);
                lines.push('DESCRIPTION:' + desc);
                lines.push('CATEGORIES:æ€ç»´è®­ç»ƒè¥,Week' + weekNum);
                lines.push('BEGIN:VALARM');
                lines.push('TRIGGER:-PT30M');
                lines.push('ACTION:DISPLAY');
                lines.push('DESCRIPTION:ä»Šå¤©çš„æ€ç»´è®­ç»ƒè¿˜æ²¡åšå“¦ï¼');
                lines.push('END:VALARM');
                lines.push('END:VEVENT');
            });

            lines.push('END:VCALENDAR');

            const icsContent = lines.join('\r\n');
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'æ€ç»´è®­ç»ƒè¥-21å¤©æ‰“å¡æ—¥å†.ics';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // æŒ‰é’®åé¦ˆ
            const orig = btn.innerHTML;
            btn.innerHTML = '<span style="color:#10b981">âœ…</span> å·²å¯¼å‡º';
            setTimeout(() => { btn.innerHTML = orig; }, 2500);
        }

        function getTodayStr() {
            const d = new Date();
            const y = d.getFullYear();
            const m = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return y + '-' + m + '-' + day;
        }

        function formatIcsDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return y + m + d;
        }

        init();
    </script>
</body>
</html>